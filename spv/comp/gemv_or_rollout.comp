#version 450
layout(local_size_x = 256) in;

layout(std430, set=0, binding=0) readonly buffer ZI { float z_in[]; };
layout(std430, set=0, binding=1) readonly buffer A  { float Arow[]; }; // row-major DÃ—D
layout(std430, set=0, binding=2) readonly buffer B  { float b[]; };
layout(std430, set=0, binding=3) writeonly buffer ZO { float z_out[]; };

layout(push_constant) uniform PC { uint D; } pc;

void main() {
    uint i = gl_GlobalInvocationID.x;
    if (i >= pc.D) return;

    float acc = b[i];
    uint row = i * pc.D;
    for (uint j = 0; j < pc.D; j++) {
        acc += Arow[row + j] * z_in[j];
    }
    z_out[i] = acc;
}
